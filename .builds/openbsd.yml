image: openbsd/latest
packages:
- gas
sources:
- https://git.sr.ht/~mcf/cproc
- git://c9x.me/qbe.git
tasks:
- setup: |
    # use __builtin_va_* even on non __GNUC__ compilers
    doas patch -d /usr/include < cproc/.builds/openbsd.diff
- build: |
    PATH=$HOME/qbe:$PATH
    make -C qbe
    cd cproc
    ./configure --with-as=gas
    make all check bootstrap
triggers:
- action: email
  condition: failure
  to: "<~mcf/cproc-builds@lists.sr.ht>"
